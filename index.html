<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>かんたん一括画像リサイズ & WebP圧縮（ブラウザで完結）</title>
<meta name="description" content="ドラッグ&ドロップで画像を一括リサイズ・圧縮。JPEG/PNG/WebPに変換。インストール不要・無料・ブラウザで完結。">
<style>
  :root {
    --bg: #0f1220;
    --card: #161a2b;
    --text: #e8ecf1;
    --muted: #a8b3c7;
    --accent: #7cd1ff;
    --accent-2: #8affc1;
    --danger: #ff6b6b;
    --ok: #9dff9d;
  }
  * { box-sizing: border-box; }
  html, body {
    margin: 0; padding: 0;
    background: linear-gradient(180deg, #0f1220, #0d1020 60%, #0f1220);
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", sans-serif;
  }
  header { padding: 28px 16px 8px; text-align: center; }
  header h1 { font-size: 22px; margin: 0 0 6px; letter-spacing: .03em; }
  header p { margin: 0; color: var(--muted); font-size: 13px; }
  .container { max-width: 980px; margin: 0 auto; padding: 16px; }
  .panel {
    background: linear-gradient(180deg, rgba(124,209,255,.06), rgba(138,255,193,.06));
    border: 1px solid rgba(124,209,255,.2);
    border-radius: 14px;
    padding: 16px; margin-bottom: 14px;
  }
  .grid { display: grid; gap: 14px; grid-template-columns: repeat(12, 1fr); }
  .col-12 { grid-column: span 12; } .col-6 { grid-column: span 6; }
  @media (max-width: 760px) { .col-6 { grid-column: span 12; } }
  label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
  input[type="number"], select {
    width: 100%; background: var(--card); color: var(--text);
    border: 1px solid rgba(124,209,255,.25);
    padding: 10px 12px; border-radius: 10px; outline: none;
  }
  input[type="range"] { width: 100%; }
  .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
  .btn {
    background: linear-gradient(180deg, rgba(124,209,255,.18), rgba(124,209,255,.12));
    color: var(--text); border: 1px solid rgba(124,209,255,.35);
    padding: 10px 14px; border-radius: 10px; cursor: pointer;
    font-weight: 600; letter-spacing: .02em;
    text-decoration: none; display: inline-block;
  }
  .btn:hover { border-color: rgba(138,255,193,.6); }
  .btn.danger { border-color: rgba(255,107,107,.5); background: rgba(255,107,107,.15); }
  .hint { font-size: 12px; color: var(--muted); }
  .dropzone {
    border: 1.5px dashed rgba(124,209,255,.4);
    background: rgba(12, 16, 34, .8);
    border-radius: 14px; padding: 18px; text-align: center;
    transition: .15s border-color ease;
  }
  .dropzone.dragover { border-color: var(--accent-2); background: rgba(14, 24, 50, .9); }
  .gallery { display: grid; gap: 12px; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
  .card { background: var(--card); border: 1px solid rgba(124,209,255,.2); border-radius: 12px; overflow: hidden; }
  .card img { width: 100%; display: block; background: #0b0e1a; }
  .card .meta { padding: 10px; font-size: 12px; color: var(--muted); }
  .badge { display: inline-block; padding: 2px 8px; font-size: 11px; border-radius: 99px; border: 1px solid rgba(124,209,255,.35); color: var(--text); }
  .footer { text-align: center; font-size: 12px; color: var(--muted); padding: 16px 8px 32px; }
  .progress { height: 8px; border-radius: 99px; background: rgba(255,255,255,.06); overflow: hidden; }
  .progress > div { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); transition: width .2s ease; }
</style>
</head>
<body>
<header>
  <h1>かんたん一括画像リサイズ & WebP圧縮</h1>
  <p>ドラッグ&ドロップで画像をまとめて変換。インストール不要・無料・安全（ローカル処理のみ）。</p>
</header>

<div class="container">
  <div class="panel">
    <div class="grid">
      <div class="col-6">
        <label>最大幅（px）</label>
        <input type="number" id="maxWidth" value="1080" min="64" step="1">
      </div>
      <div class="col-6">
        <label>最大高（px）</label>
        <input type="number" id="maxHeight" value="1920" min="64" step="1">
      </div>
      <div class="col-6">
        <label>出力フォーマット</label>
        <select id="format">
          <option value="image/webp">WebP（推奨・小さい）</option>
          <option value="image/jpeg">JPEG</option>
          <option value="image/png">PNG（非可逆圧縮なし）</option>
        </select>
      </div>
      <div class="col-6">
        <label>画質（JPEG/WebPのみ） <span id="qLabel" class="hint">0.8</span></label>
        <input type="range" id="quality" min="0.1" max="1" step="0.05" value="0.8">
      </div>
      <div class="col-12 row">
        <input type="file" id="fileInput" multiple accept="image/*" style="display:none;" />
        <button class="btn" id="pickBtn">画像を選ぶ</button>
        <button class="btn danger" id="clearBtn">リセット</button>
        <span class="hint">ヒント：9:16（1080×1920）や16:9（1920×1080）などに一括調整できます。</span>
      </div>
    </div>
  </div>

  <div class="panel dropzone" id="dropzone">
    <strong>ここに画像をドラッグ&ドロップ</strong><br/>
    または「画像を選ぶ」ボタンを使ってください。
  </div>

  <div class="panel">
    <div class="row" style="justify-content: space-between;">
      <div class="hint">読み込み → 自動変換 → 下のギャラリーに結果が並びます。</div>
      <button class="btn" id="downloadAllBtn">すべてダウンロード</button>
    </div>
    <div class="progress" style="margin-top:10px;"><div id="bar"></div></div>
  </div>

  <div class="gallery" id="gallery"></div>
</div>

<div class="footer">
  <div>ブラウザ内で処理するため、画像はネットにアップロードされません。</div>
  <div style="margin-top:6px;">© 2025 QuickTools</div>
</div>

<script>
(function(){
  const maxWidthEl = document.getElementById('maxWidth');
  const maxHeightEl = document.getElementById('maxHeight');
  const formatEl = document.getElementById('format');
  const qualityEl = document.getElementById('quality');
  const qLabel = document.getElementById('qLabel');
  const fileInput = document.getElementById('fileInput');
  const pickBtn = document.getElementById('pickBtn');
  const clearBtn = document.getElementById('clearBtn');
  const dropzone = document.getElementById('dropzone');
  const gallery = document.getElementById('gallery');
  const downloadAllBtn = document.getElementById('downloadAllBtn');
  const bar = document.getElementById('bar');

  let results = []; // {blob, name, w, h, size}

  qualityEl.addEventListener('input', ()=> qLabel.textContent = qualityEl.value);

  pickBtn.addEventListener('click', ()=> fileInput.click());
  clearBtn.addEventListener('click', ()=> {
    results = [];
    gallery.innerHTML = '';
    bar.style.width = '0%';
  });

  fileInput.addEventListener('change', (e)=> handleFiles(e.target.files));

  ;['dragenter','dragover'].forEach(ev=> dropzone.addEventListener(ev, e=>{
    e.preventDefault(); e.stopPropagation();
    dropzone.classList.add('dragover');
  }));
  ;['dragleave','drop'].forEach(ev=> dropzone.addEventListener(ev, e=>{
    e.preventDefault(); e.stopPropagation();
    if (ev === 'drop') {
      const dt = e.dataTransfer;
      const files = dt.files;
      handleFiles(files);
    }
    dropzone.classList.remove('dragover');
  }));

  async function handleFiles(fileList) {
    const files = Array.from(fileList).filter(f => f.type.startsWith('image/'));
    if (!files.length) return;
    const total = files.length;
    let done = 0;
    for (const f of files) {
      try {
        const out = await processImageFile(f);
        results.push(out);
        addCard(out);
      } catch(err) {
        console.error('convert error', err);
      } finally {
        done++;
        bar.style.width = Math.round(done/total*100) + '%';
      }
    }
  }

  function loadImageFromFile(file) {
    return new Promise((resolve, reject)=>{
      const url = URL.createObjectURL(file);
      const img = new Image();
      img.onload = ()=> {
        URL.revokeObjectURL(url);
        resolve(img);
      };
      img.onerror = reject;
      img.src = url;
    });
  }

  async function processImageFile(file) {
    const img = await loadImageFromFile(file);
    const maxW = Math.max(64, parseInt(maxWidthEl.value || '1080', 10));
    const maxH = Math.max(64, parseInt(maxHeightEl.value || '1920', 10));
    const fmt = formatEl.value;
    const q = parseFloat(qualityEl.value || '0.8');

    // リサイズ比率（アスペクト維持）
    let {width: w, height: h} = img;
    const scale = Math.min(maxW / w, maxH / h, 1);
    const outW = Math.round(w * scale);
    const outH = Math.round(h * scale);

    const canvas = document.createElement('canvas');
    canvas.width = outW; canvas.height = outH;
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = 'high';
    ctx.drawImage(img, 0, 0, outW, outH);

    const blob = await new Promise(resolve => {
      if (fmt === 'image/png') {
        canvas.toBlob(resolve, 'image/png');
      } else if (fmt === 'image/webp') {
        canvas.toBlob(resolve, 'image/webp', q);
      } else {
        canvas.toBlob(resolve, 'image/jpeg', q);
      }
    });

    const nameBase = (file.name || 'image').replace(/\.[^.]+$/, '');
    const ext = fmt === 'image/png' ? 'png' : (fmt === 'image/webp' ? 'webp' : 'jpg');
    const outName = `${nameBase}-${outW}x${outH}.${ext}`;

    return { blob, name: outName, w: outW, h: outH, size: blob ? blob.size : 0 };
  }

  function addCard({blob, name, w, h, size}) {
    const url = URL.createObjectURL(blob);
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${url}" alt="${name}" />
      <div class="meta">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
          <span class="badge">${w}×${h}</span>
          <a class="btn" download="${name}" href="${url}">ダウンロード</a>
        </div>
        <div class="hint" style="margin-top:6px;">${name} ・ ${formatBytes(size)}</div>
      </div>
    `;
    gallery.prepend(card);
  }

  function formatBytes(bytes){
    if (!bytes && bytes !== 0) return '-';
    const k = 1024;
    const sizes = ['B','KB','MB','GB'];
    const i = Math.floor(Math.log(bytes)/Math.log(k));
    return (bytes/Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
  }

  downloadAllBtn.addEventListener('click', async ()=>{
    if (!results.length) return;
    for (const r of results) {
      const a = document.createElement('a');
      const url = URL.createObjectURL(r.blob);
      a.href = url; a.download = r.name;
      document.body.appendChild(a);
      a.click();
      a.remove();
      await new Promise(res=> setTimeout(res, 80));
      URL.revokeObjectURL(url);
    }
  });
})();
</script>
</body>
</html>
